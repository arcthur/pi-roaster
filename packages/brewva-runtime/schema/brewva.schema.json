{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$ref": "#/definitions/BrewvaConfigFile",
  "title": "brewva BrewvaConfigFile",
  "description": "JSON Schema for .brewva/brewva.json (Brewva config patch file).",
  "definitions": {
    "BrewvaConfigFile": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "$schema": {
          "type": "string"
        },
        "infrastructure": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "contextBudget": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "compactionInstructions": {
                  "type": "string"
                },
                "compactionThresholdPercent": {
                  "type": "number"
                },
                "enabled": {
                  "type": "boolean"
                },
                "hardLimitPercent": {
                  "type": "number"
                },
                "maxInjectionTokens": {
                  "type": "number"
                },
                "truncationStrategy": {
                  "type": "string",
                  "enum": ["drop-entry", "summarize", "tail"]
                }
              }
            },
            "costTracking": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "actionOnExceed": {
                  "type": "string",
                  "enum": ["warn", "block_tools"]
                },
                "alertThresholdRatio": {
                  "type": "number"
                },
                "enabled": {
                  "type": "boolean"
                },
                "maxCostUsdPerSession": {
                  "type": "number"
                }
              }
            },
            "events": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "dir": {
                  "type": "string"
                },
                "enabled": {
                  "type": "boolean"
                },
                "level": {
                  "type": "string",
                  "enum": ["audit", "ops", "debug"]
                }
              }
            },
            "interruptRecovery": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "enabled": {
                  "type": "boolean"
                },
                "gracefulTimeoutMs": {
                  "type": "number"
                }
              }
            },
            "toolFailureInjection": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "enabled": {
                  "type": "boolean"
                },
                "maxEntries": {
                  "type": "number"
                },
                "maxOutputChars": {
                  "type": "number"
                }
              }
            },
            "turnWal": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "compactAfterMs": {
                  "type": "number"
                },
                "defaultTtlMs": {
                  "type": "number"
                },
                "dir": {
                  "type": "string"
                },
                "enabled": {
                  "type": "boolean"
                },
                "maxRetries": {
                  "type": "number"
                },
                "scheduleTurnTtlMs": {
                  "type": "number"
                }
              }
            }
          }
        },
        "ledger": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "checkpointEveryTurns": {
              "type": "number"
            },
            "path": {
              "type": "string"
            }
          }
        },
        "memory": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "cognitive": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "maxTokensPerTurn": {
                  "type": "number"
                },
                "mode": {
                  "type": "string",
                  "enum": ["off", "shadow", "active"]
                }
              }
            },
            "crystalMinUnits": {
              "type": "number"
            },
            "dailyRefreshHourLocal": {
              "type": "number"
            },
            "dir": {
              "type": "string"
            },
            "enabled": {
              "type": "boolean"
            },
            "evolvesMode": {
              "type": "string",
              "enum": ["off", "shadow"]
            },
            "global": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "enabled": {
                  "type": "boolean"
                },
                "minConfidence": {
                  "type": "number"
                }
              }
            },
            "maxWorkingChars": {
              "type": "number"
            },
            "retrievalTopK": {
              "type": "number"
            },
            "retrievalWeights": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "confidence": {
                  "type": "number"
                },
                "lexical": {
                  "type": "number"
                },
                "recency": {
                  "type": "number"
                }
              }
            },
            "workingFile": {
              "type": "string"
            }
          }
        },
        "parallel": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "maxConcurrent": {
              "type": "number"
            }
          }
        },
        "schedule": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "leaseDurationMs": {
              "type": "number"
            },
            "maxActiveIntentsGlobal": {
              "type": "number"
            },
            "maxActiveIntentsPerSession": {
              "type": "number"
            },
            "maxConsecutiveErrors": {
              "type": "number"
            },
            "maxRecoveryCatchUps": {
              "type": "number"
            },
            "minIntervalMs": {
              "type": "number"
            },
            "projectionPath": {
              "type": "string"
            }
          }
        },
        "security": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "execution": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "backend": {
                  "type": "string",
                  "enum": ["host", "sandbox", "auto"]
                },
                "commandDenyList": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                "enforceIsolation": {
                  "type": "boolean"
                },
                "fallbackToHost": {
                  "type": "boolean"
                },
                "sandbox": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "apiKey": {
                      "type": "string"
                    },
                    "cpus": {
                      "type": "number"
                    },
                    "defaultImage": {
                      "type": "string"
                    },
                    "memory": {
                      "type": "number"
                    },
                    "serverUrl": {
                      "type": "string"
                    },
                    "timeout": {
                      "type": "number"
                    }
                  }
                }
              }
            },
            "mode": {
              "type": "string",
              "enum": ["permissive", "standard", "strict"]
            },
            "sanitizeContext": {
              "type": "boolean"
            }
          }
        },
        "skills": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "disabled": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "overrides": {
              "type": "object",
              "additionalProperties": {
                "$ref": "#/definitions/SkillContractOverride"
              }
            },
            "packs": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "roots": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "selector": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "k": {
                  "type": "number"
                }
              }
            }
          }
        },
        "tape": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "checkpointIntervalEntries": {
              "type": "number"
            }
          }
        },
        "ui": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "quietStartup": {
              "type": "boolean"
            }
          }
        },
        "verification": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "checks": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "quick": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                "standard": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                "strict": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                }
              }
            },
            "commands": {
              "type": "object",
              "additionalProperties": {
                "type": "string"
              }
            },
            "defaultLevel": {
              "$ref": "#/definitions/VerificationLevel"
            }
          }
        }
      }
    },
    "SkillContractOverride": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "description": {
          "type": "string"
        },
        "antiTags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "budget": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "maxTokens": {
              "type": "number"
            },
            "maxToolCalls": {
              "type": "number"
            }
          }
        },
        "composableWith": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "consumes": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "costHint": {
          "$ref": "#/definitions/SkillCostHint"
        },
        "escalationPath": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "maxParallel": {
          "type": "number"
        },
        "name": {
          "type": "string"
        },
        "outputs": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "stability": {
          "type": "string",
          "enum": ["experimental", "stable", "deprecated"]
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "tier": {
          "$ref": "#/definitions/SkillTier"
        },
        "tools": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "required": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "denied": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "optional": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "version": {
          "type": "string"
        }
      }
    },
    "SkillCostHint": {
      "type": "string",
      "enum": ["low", "medium", "high"]
    },
    "SkillTier": {
      "type": "string",
      "enum": ["base", "pack", "project"]
    },
    "VerificationLevel": {
      "type": "string",
      "enum": ["quick", "standard", "strict"]
    }
  }
}
